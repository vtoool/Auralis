# Developer Guide: Auralis Wellness Platform

This guide provides instructions on how to set up the backend, integrate payments, and deploy the Auralis wellness platform application.

## Table of Contents
1.  [Backend Setup with Supabase](#1-backend-setup-with-supabase)
2.  [Email Notifications with Resend](#2-email-notifications-with-resend)
3.  [Backend Logic with Supabase Edge Functions](#3-backend-logic-with-supabase-edge-functions)
4.  [Automating Emails with Database Webhooks](#4-automating-emails-with-database-webhooks)
5.  [Owner Dashboard & Management](#5-owner-dashboard--management)
6.  [Payment Integration with Paddle](#6-payment-integration-with-paddle)
7.  [Deployment](#7-deployment)

---

## 1. Backend Setup with Supabase

Supabase is an open-source Firebase alternative providing a PostgreSQL database, authentication, file storage, and serverless functions.

### Step 1: Create a Supabase Project

1.  Go to [supabase.com](https://supabase.com) and sign up/log in.
2.  Create a new project. Choose a strong database password and save it securely.

### Step 2: Run the Database Setup Script

Navigate to the **SQL Editor** in your Supabase dashboard. Click "+ New query" and paste the entire script below. This will create your `courses`, `appointments`, and `unavailabilities` tables and add sample course data.

```sql
-- 1. Create the 'courses' table
CREATE TABLE public.courses (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
  title TEXT NOT NULL,
  description TEXT,
  type TEXT,
  price NUMERIC,
  "imageUrl" TEXT,
  duration TEXT,
  paddle_product_id TEXT,
  file_url TEXT -- To store the link to the course video/audio file
);

-- Note: For now we disable Row Level Security (RLS) for easy development.
-- You should enable and configure RLS policies before going to production.
ALTER TABLE public.courses DISABLE ROW LEVEL SECURITY;

-- 2. Insert mock data to populate the courses section
INSERT INTO public.courses (title, description, type, price, "imageUrl", duration, paddle_product_id)
VALUES
  ('Foundations of Mindfulness', 'A comprehensive video series teaching the core principles of mindfulness to reduce stress and cultivate presence.', 'Video Course', 49.99, 'https://picsum.photos/400/300?random=10', '4 Hours', 'prod_12345'),
  ('Morning Gratitude Meditation', 'Begin each day with a positive and grateful mindset through this beautifully guided audio meditation.', 'Audio Meditation', 9.99, 'https://picsum.photos/400/300?random=11', '15 Mins', 'prod_12346'),
  ('Chakra Balancing for Beginners', 'An introductory video course to understanding, clearing, and balancing your seven chakras for spiritual well-being.', 'Video Course', 69.99, 'https://picsum.photos/400/300?random=12', '6 Hours', 'prod_12347'),
  ('Deep Sleep Hypnosis', 'A soothing audio journey designed to help you release the day and drift into a deep, restorative, and peaceful sleep.', 'Audio Meditation', 14.99, 'https://picsum.photos/400/300?random=13', '30 Mins', 'prod_12348');

-- 3. Create the 'appointments' table
CREATE TABLE public.appointments (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
  name TEXT NOT NULL,
  email TEXT NOT NULL,
  date DATE NOT NULL,
  time TEXT NOT NULL
);

ALTER TABLE public.appointments DISABLE ROW LEVEL SECURITY;

-- 4. Create the 'unavailabilities' table for the owner to block out times
CREATE TABLE public.unavailabilities (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
  unavailable_date DATE NOT NULL,
  start_time TIME, -- Can be null if the whole day is blocked
  end_time TIME,   -- Can be null if the whole day is blocked
  reason TEXT      -- Optional reason, e.g., "Holiday"
);

ALTER TABLE public.unavailabilities DISABLE ROW LEVEL SECURITY;
```

### Step 3: Connect Frontend to Supabase

In `src/services/supabaseClient.ts`, ensure your Supabase URL and `anon` key are correctly configured. For production, these should be stored as environment variables.

---

## 2. Email Notifications with Resend

Resend is a modern email API for developers. We'll use it to send booking confirmations.

1.  **Create an Account:** Go to [resend.com](https://resend.com) and sign up for a free account.
2.  **Add and Verify Your Domain:** To send emails that don't land in spam, you must send from a domain you own. Follow their guide to add your domain and verify the DNS records. For testing, you can send emails from `onboarding@resend.dev`, but this is not for production use.
3.  **Get API Key:** Go to the **API Keys** section and create a new key. Copy it and keep it safe; you'll need it in the next step.

---

## 3. Backend Logic with Supabase Edge Functions

We'll write a serverless function to handle the logic of sending emails.

### Step 1: Install Supabase CLI

Follow the official guide to [install the Supabase CLI](https://supabase.com/docs/guides/cli) on your machine.

### Step 2: Initialize Supabase Project

In your project's root directory, log in and link your project:
```bash
supabase login
supabase link --project-ref YOUR_PROJECT_ID
```
(Find `YOUR_PROJECT_ID` in your Supabase project's URL: `https://app.supabase.com/project/YOUR_PROJECT_ID`).

### Step 3: Create the Edge Function

1.  Create a new function:
    ```bash
    supabase functions new send-booking-emails
    ```
    This creates a folder `supabase/functions/send-booking-emails`.

2.  Replace the contents of `supabase/functions/send-booking-emails/index.ts` with the following code:
    ```typescript
    import { serve } from 'https://deno.land/std@0.168.0/http/server.ts'

    // NOTE: In a real project, you should use a proper email templating library
    // to build more robust and beautiful emails.

    const RESEND_API_KEY = Deno.env.get('RESEND_API_KEY')
    const OWNER_EMAIL = Deno.env.get('OWNER_EMAIL') // Your email address
    const FROM_EMAIL = 'Auralis Wellness <hello@your-verified-domain.com>' // Use your verified domain

    serve(async (req) => {
      // This function is designed to be triggered by a Supabase Webhook.
      // The webhook payload has a 'record' property containing the new appointment.
      const { record } = await req.json();

      try {
        // 1. Email to the Customer
        const customerResponse = await fetch('https://api.resend.com/emails', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${RESEND_API_KEY}`,
          },
          body: JSON.stringify({
            from: FROM_EMAIL,
            to: record.email,
            subject: 'Your Appointment is Confirmed!',
            html: `<h1>Hi ${record.name},</h1><p>Your session with Alice is confirmed for <strong>${record.date}</strong> at <strong>${record.time}</strong>.</p><p>We look forward to seeing you!</p>`,
          }),
        });
        const customerData = await customerResponse.json();
        if (!customerResponse.ok) throw new Error(customerData.message);

        // 2. Notification Email to the Owner
        const ownerResponse = await fetch('https://api.resend.com/emails', {
           method: 'POST',
           headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${RESEND_API_KEY}`,
           },
           body: JSON.stringify({
            from: FROM_EMAIL,
            to: OWNER_EMAIL,
            subject: `New Appointment with ${record.name}`,
            html: `<p>A new appointment has been booked:</p><ul><li><strong>Name:</strong> ${record.name}</li><li><strong>Email:</strong> ${record.email}</li><li><strong>Date:</strong> ${record.date}</li><li><strong>Time:</strong> ${record.time}</li></ul>`,
           })
        });
        const ownerData = await ownerResponse.json();
        if (!ownerResponse.ok) throw new Error(ownerData.message);


        return new Response(JSON.stringify({ message: "Emails sent successfully" }), {
          headers: { 'Content-Type': 'application/json' },
          status: 200,
        });

      } catch (error) {
        console.error('Error sending email:', error);
        return new Response(JSON.stringify({ error: error.message }), {
          headers: { 'Content-Type': 'application/json' },
          status: 500,
        });
      }
    });
    ```

### Step 4: Set Secrets and Deploy

1.  Set your Resend API key and your own email address as secrets for the function.
    ```bash
    supabase secrets set RESEND_API_KEY="re_YourResendApiKey"
    supabase secrets set OWNER_EMAIL="your.email@example.com"
    ```

2.  Deploy the function to Supabase.
    ```bash
    supabase functions deploy send-booking-emails --no-verify-jwt
    ```
    The `--no-verify-jwt` flag is important because this function will be called by a webhook, not an authenticated user.

---

## 4. Automating Emails with Database Webhooks

This step connects your database to your function.

1.  In your Supabase dashboard, go to **Database > Webhooks**.
2.  Click **Create a new webhook**.
3.  **Name:** `Send Appointment Emails`
4.  **Table:** Choose the `appointments` table.
5.  **Events:** Check **`INSERT`**.
6.  **Webhook URL:** This is the URL of the function you just deployed. Go to **Edge Functions** in the Supabase dashboard, select your function, and copy its URL.
7.  **HTTP Headers:** Leave this as default.
8.  Click **Create webhook**.

Now, every time a new row is inserted into `appointments`, this webhook will automatically trigger your function and send the emails!

---

## 5. Owner Dashboard & Management

This section requires building new frontend components, which is beyond the scope of this guide, but here is the backend setup required.

### Step 1: Set up Authentication

1.  Go to **Authentication > Providers** in Supabase and enable the **Email** provider.
2.  You will build a login page in your React app (e.g., at a `/login` route) that uses `supabase.auth.signInWithPassword()`.
3.  The admin dashboard pages (e.g., `/admin/*`) should be protected routes that check if a user is logged in using `supabase.auth.getSession()`.

### Step 2: Set up File Storage for Courses

1.  Go to **Storage** in your Supabase dashboard and click **Create a new bucket**.
2.  **Bucket name:** `courses`
3.  Make the bucket **public** for easy access to the files.
4.  **Security Policies:** For production, you should write RLS policies to restrict uploads. For example, create a policy that only allows an authenticated user with a specific role (e.g., 'admin') to upload files to this bucket.

On your admin dashboard, you'll create a form that uses the Supabase client library to upload files: `supabase.storage.from('courses').upload(...)`. After a successful upload, you save the file's public URL to the `file_url` column in your `courses` table.

### Step 3: Manage Availability

The `unavailabilities` table is already created. Your admin dashboard will have a calendar interface. When you block a date/time, the frontend will simply `insert` a row into this table.

The public-facing `Booking.tsx` component must be updated to fetch from this table *before* rendering the time slots. Any slots that overlap with records in `unavailabilities` should be marked as `available: false`.

---

## 6. Payment Integration with Paddle

Paddle provides a complete payments infrastructure.

### Step 1: Setup Paddle

1.  Create an account on [Paddle](https://paddle.com).
2.  Go to **Catalog > Products** and create products for each course. Note the **Product ID** for each. You will store this ID in the `paddle_product_id` column of your `courses` table.
3.  Go to **Developer Tools > Authentication** to get your **Client-side Token**.

### Step 2: Integrate Paddle.js

In `CourseCard.tsx`, update the `handleBuyNow` function to trigger the Paddle checkout. This requires adding Paddle's JS library and initializing it.

---

## 7. Deployment

Deploying your frontend is straightforward with a service like Vercel or Netlify.

1.  Push your project to a Git provider (GitHub, GitLab).
2.  Import the project into Vercel/Netlify.
3.  **Configure Environment Variables:** In the deployment platform's settings, you **must** add your Supabase credentials so the frontend can connect to it. They must be prefixed with `VITE_` (if using Vite, the default for this project).
    *   `VITE_SUPABASE_URL`: Your Supabase Project URL.
    *   `VITE_SUPABASE_ANON_KEY`: Your Supabase `anon` public key.
4.  Deploy. Your site will be live in minutes!
